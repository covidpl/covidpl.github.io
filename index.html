<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>COVID-19 w powiatach</title><style>body{background:#eee}*{margin:0;padding:0}svg{fill:#fff;stroke:#777;stroke-width:1px;margin-left:auto;margin-right:auto;max-width:80vh}.sel{stroke-width:7px;stroke:#fff;filter:drop-shadow(0 0 20px #111)}select{border:0;background-color:transparent}select#sfield{font-size:x-large;font-weight:700}#time{display:block;margin:0 auto;width:100%}#mc{text-align:center}#cc{margin:0 1em}#expl{max-width:60em;color:#aaa;margin:0 auto;width:80%;font-size:smaller}a:link,a:visited{color:inherit}</style></head><body><div id="cc"><select id="sfield" name="field"></select> <select id="sw" name="w"></select> <input id="time" type="range" min="0" max="0"> <span id="range"></span> <span id="sel"></span></div><div id="mc"></div><div id="expl"><div id="dsc"></div><div>Źródła danych: <a href="https://covid19-rcb-gis.hub.arcgis.com2/">Serwis gov.pl</a> (dane aktualne), <a href="https://bit.ly/covid19-poland">Arkusz COVID-19 w Polsce autorstwa Michała Rogalskiego</a> (dane archiwalne), <a href="https://www.geoportal.gov.pl/dane/panstwowy-rejestr-granic">GUGiK</a> (granice powiatów), <a href="https://stat.gov.pl">GUS</a> (populacja w powiatach na 2020). Serwis dostarczany jak jest, bez żadnych gwarancji, tylko do celów poglądowych; używasz na własną odpowiedzialność. Powierzchnia powiatów na kartogramie jest proporcjonalna do liczby mieszkańców. Przypadki bez przypisanego powiatu nie są zliczane; dane archiwalne zostały poddane imputacji. Opracowanie: <a href="https://mbq.me">mbq</a>.</div></div><script>const ns="http://www.w3.org/2000/svg",magma=["#000004","#010005","#010106","#010108","#020109","#02020b","#02020d","#03030f","#030312","#040414","#050416","#060518","#06051a","#07061c","#08071e","#090720","#0a0822","#0b0924","#0c0926","#0d0a29","#0e0b2b","#100b2d","#110c2f","#120d31","#130d34","#140e36","#150e38","#160f3b","#180f3d","#19103f","#1a1042","#1c1044","#1d1147","#1e1149","#20114b","#21114e","#221150","#241253","#251255","#271258","#29115a","#2a115c","#2c115f","#2d1161","#2f1163","#311165","#331067","#341069","#36106b","#38106c","#390f6e","#3b0f70","#3d0f71","#3f0f72","#400f74","#420f75","#440f76","#451077","#471078","#491078","#4a1079","#4c117a","#4e117b","#4f127b","#51127c","#52137c","#54137d","#56147d","#57157e","#59157e","#5a167e","#5c167f","#5d177f","#5f187f","#601880","#621980","#641a80","#651a80","#671b80","#681c81","#6a1c81","#6b1d81","#6d1d81","#6e1e81","#701f81","#721f81","#732081","#752181","#762181","#782281","#792282","#7b2382","#7c2382","#7e2482","#802582","#812581","#832681","#842681","#862781","#882781","#892881","#8b2981","#8c2981","#8e2a81","#902a81","#912b81","#932b80","#942c80","#962c80","#982d80","#992d80","#9b2e7f","#9c2e7f","#9e2f7f","#a02f7f","#a1307e","#a3307e","#a5317e","#a6317d","#a8327d","#aa337d","#ab337c","#ad347c","#ae347b","#b0357b","#b2357b","#b3367a","#b5367a","#b73779","#b83779","#ba3878","#bc3978","#bd3977","#bf3a77","#c03a76","#c23b75","#c43c75","#c53c74","#c73d73","#c83e73","#ca3e72","#cc3f71","#cd4071","#cf4070","#d0416f","#d2426f","#d3436e","#d5446d","#d6456c","#d8456c","#d9466b","#db476a","#dc4869","#de4968","#df4a68","#e04c67","#e24d66","#e34e65","#e44f64","#e55064","#e75263","#e85362","#e95462","#ea5661","#eb5760","#ec5860","#ed5a5f","#ee5b5e","#ef5d5e","#f05f5e","#f1605d","#f2625d","#f2645c","#f3655c","#f4675c","#f4695c","#f56b5c","#f66c5c","#f66e5c","#f7705c","#f7725c","#f8745c","#f8765c","#f9785d","#f9795d","#f97b5d","#fa7d5e","#fa7f5e","#fa815f","#fb835f","#fb8560","#fb8761","#fc8961","#fc8a62","#fc8c63","#fc8e64","#fc9065","#fd9266","#fd9467","#fd9668","#fd9869","#fd9a6a","#fd9b6b","#fe9d6c","#fe9f6d","#fea16e","#fea36f","#fea571","#fea772","#fea973","#feaa74","#feac76","#feae77","#feb078","#feb27a","#feb47b","#feb67c","#feb77e","#feb97f","#febb81","#febd82","#febf84","#fec185","#fec287","#fec488","#fec68a","#fec88c","#feca8d","#fecc8f","#fecd90","#fecf92","#fed194","#fed395","#fed597","#fed799","#fed89a","#fdda9c","#fddc9e","#fddea0","#fde0a1","#fde2a3","#fde3a5","#fde5a7","#fde7a9","#fde9aa","#fdebac","#fcecae","#fceeb0","#fcf0b2","#fcf2b4","#fcf4b6","#fcf6b8","#fcf7b9","#fcf9bb","#fcfbbd","#fcfdbf"];magma.reverse();let Source={},Plot=new Map,Selection=!1,tr0=+new Date("1970-01-01"),PlotSvg=document.createElementNS(ns,"svg");function decode_array(e){return e.flatMap(e=>e<0?Array.from({length:1-e},e=>0):[e])}function decode_array_cml(e){let a=0,t=decode_array(e).map(e=>(a+=e,a));return t.unshift(0),t}function window_sum(e,a){let t=e.slice(0,-a);return e.slice(a).map((e,a)=>e-t[a])}document.getElementById("mc").appendChild(PlotSvg);const Fields=[["cases_per_100k","Przypadki COVID-19",e=>{let t=0==Source.w?Source.tr[1]-Source.tr[0]+1:Source.w,a=[...Source.new_cases].map(a=>{var e=window_sum(decode_array_cml(a[1]),t).map(e=>e/t/Source.pop.get(a[0])*1e5);return[a[0],e]});var c=a.reduce((e,a)=>Math.max(e,a[1].reduce((e,a)=>Math.max(e,a),0)),0),r=a.reduce((e,a)=>Math.min(e,a[1].reduce((e,a)=>Math.min(e,a),1/0)),1/0);return{v:a,min:r,max:c,ts:Source.tr[1]-a[0][1].length,te:Source.tr[1],th:1,unit:"/100k",longer:"Średnia dzienna liczba przypadków COVID-19 na 100 tysięcy mieszkańców."}}],["cases_per_pop_nrm","Znormalizowane przypadki",e=>{let c=0;Source.pop.forEach(e=>c+=e);let r=0==Source.w?Source.tr[1]-Source.tr[0]+1:Source.w,a=[...Source.new_cases].map(a=>{var e=window_sum(decode_array_cml(a[1]),r).map(e=>e/r),t=window_sum(decode_array_cml(a[1]),r).map(e=>e/r/Source.pop.get(a[0]));return[a[0],t,e]}),o=Array.from({length:a[0][1].length},e=>0);a.forEach(e=>e[2].forEach((e,a)=>{o[a]=o[a]+e})),a.forEach(e=>e[1].forEach((e,a,t)=>t[a]=100*e/o[a]*c));var t=a.reduce((e,a)=>Math.max(e,a[1].reduce((e,a)=>Math.max(e,a),0)),0),n=a.reduce((e,a)=>Math.min(e,a[1].reduce((e,a)=>Math.min(e,a),1/0)),1/0);return{v:a,min:n,max:t,ts:Source.tr[1]-a[0][1].length,te:Source.tr[1],th:1,unit:"% średniej krajowej",longer:"Średnia dzianna liczba przypadków na mieszkańca w relacji do średniej krajowej."}}]];let fields=new Map(Fields.map(e=>[e[0],e[2]])),fieldNames=new Map(Fields.map(e=>[e[0],e[1]])),defField="cases_per_100k",mapFiles=new Map([["carto","carto.json"],["map","pow.json"]]),defMap="carto";async function load_data(e){e=await(await fetch(new Request(e,{cache:"no-cache"}))).json();Source.new_cases=new Map(e.new_cases),Source.deaths=new Map(e.deaths),Source.tr=e.dr}async function load_pp(e){const a=await(await fetch(new Request(e))).json();Source.pow_names=new Map(a.pow.map(e=>[e[0],e[1][0]])),Source.pop=new Map(a.pow.map(e=>[e[0],e[1][1]]))}async function load_map(e){e=await(await fetch(new Request(e))).json();Source.map_title=e.name,Source.mr=e.dim,Source.map=e.map}const RangeLabel=document.getElementById("range"),SelLabel=document.getElementById("sel");function fmt(e){return e<.01?e.toPrecision(2):e.toFixed(2)}function fmtf(e){var a=e=>e.getDate()+" "+["I","II","III","IV","V","VI","VII","VIII","IX","X","XI","XII"][e.getMonth()]+" "+e.getFullYear(),t=tr0+24*(e+Source.tr[0])*60*60*1e3,e=t+24*(Source.w-1)*60*60*1e3;return 1==Source.w?a(new Date(t)):a(new Date(t))+" — "+a(new Date(e))}function namew(e){return"0"==e?"Cały zakres":"1"==e?"Dzień":"7"==e?"Tydzień":"14"==e?"Dwa tygodnie":"21"==e?"Trzy tygodnie":"28"==e?"Cztery tygodnie":e+" dni"}function paint(){Source.pending=!1;let c=Source.data.min,r=Source.data.max,o=Source.frame;var e=Source.data.unit||"";let n=0;Source.data.v.map(e=>{var a=e[0],t=(e[1][o]-c)/(r-c),t=Math.pow(t,.5),t=magma[Math.round(255*t)];Plot.get(a).setAttribute("fill",t),Selection==a&&(n=e[1][o])}),RangeLabel.innerText=fmtf(o),SelLabel.innerText=Selection?"Powiat "+Source.pow_names.get(Selection)+": "+fmt(n)+e:""}function sched_paint(){Source.pending||(Source.pending=!0,window.requestAnimationFrame(e=>paint()))}function build_ui(){let e=document.getElementById("time");Source.pending=!1;let a=Source.tr[1]-Source.tr[0]-Source.w+1;Source.frame=Math.min(Math.max(0,Source.frame||0),a),0==Source.w&&(a=0,Source.frame=0),e.setAttribute("min","0"),e.setAttribute("max",""+a),e.setAttribute("value",""+Source.frame),e.disabled=0==Source.w,document.getElementById("dsc").innerHTML=Source.data.longer||"";let t=document.getElementById("sfield");t.innerHTML=[...fieldNames.keys()].map(e=>'<option value="'+e+'"'+(e===Source.field?" selected":"")+">"+fieldNames.get(e)+"</option>").join(""),t.onchange=e=>{Source[e.target.name]=e.target.value,jump()};let c=new Set([0,7,14,21,28,Source.w]);c=[...c.values()].sort((e,a)=>e*a==0?0==e?1:-1:a<e);let r=document.getElementById("sw");r.innerHTML=c.map(e=>'<option value="'+e+'"'+(e===Source.w?" selected":"")+">"+namew(e)+"</option>").join(""),r.onchange=e=>{Source[e.target.name]=e.target.value,jump()},PlotSvg.innerHTML="",PlotSvg.setAttribute("viewBox","-40 -40 "+(Source.mr[0]+80)+" "+(Source.mr[1]+80)),0==Source.w?e.onchange=e.ontouchmove=e.onmousemove=null:e.onchange=e.ontouchmove=e.onmousemove=e=>{e=+e.target.value;e!=Source.frame&&(Source.frame=e,sched_paint())},Source.map.map(e=>{let a=document.createElementNS(ns,"path");a.setAttributeNS(null,"id",e[0]),a.setAttributeNS(null,"d",e[1]),a.setAttributeNS(null,"fill","#000"),a.onclick=e=>{e=e.target.id;Selection&&Plot.get(Selection).setAttribute("class",""),Selection=Selection!==e&&e,Selection&&(Plot.get(Selection).setAttribute("class","sel"),PlotSvg.insertBefore(Plot.get(Selection),null)),sched_paint()},Plot.set(e[0],a),PlotSvg.appendChild(a)}),paint()}function coerceWidth(e){e=e||"14";return 0<=(e=Math.round(+e))&e<1200?e:14}function coerceField(e){e=e||defField;return fields.has(e)?e:defField}function coerceMap(e){e=e||defMap;return mapFiles.has(e)?e:defMap}function reparameter(){Promise.all([load_data("covid.json"),load_pp("powp.json"),load_map(mapFiles.get(Source.mf))]).then(e=>{Source.data=fields.get(Source.field)(),build_ui()})}const makeQuery=e=>"?field="+Source.field+"&w="+Source.w+"&map="+Source.mf;function jump(){window.history.pushState({},null,makeQuery());let e=new URL(document.location).searchParams;Source.field=coerceField(e.get("field")),Source.w=coerceWidth(e.get("w")),Source.mf=coerceMap(e.get("map")),reparameter()}window.onload=e=>{let a=new URL(document.location).searchParams;Source.field=coerceField(a.get("field")),Source.w=coerceWidth(a.get("w")),Source.mf=coerceMap(a.get("map")),window.history.replaceState({},null,makeQuery()),reparameter()},window.onpopstate=e=>{let a=new URL(document.location).searchParams;Source.field=coerceField(a.get("field")),Source.w=coerceWidth(a.get("w")),Source.mf=coerceMap(a.get("map")),reparameter()};</script></body></html>